# ========================================================================
# APPOINTMENT SERVICE - APPLICATION CONFIGURATION
# ========================================================================

spring.application.name=Appointment-Service
server.port=8083

# ========================================================================
# MONGODB CONFIGURATION
# ========================================================================

spring.data.mongodb.uri=mongodb://localhost:27017/appointment-service
spring.data.mongodb.auto-index-creation=true

# ========================================================================
# KEYCLOAK CONFIGURATION (OAuth2 Resource Server)
# ========================================================================
# IMPORTANT: This replaces the old JWT secret configuration!
# Appointment service now validates tokens via Keycloak

# Keycloak server URL
keycloak.auth-server-url=http://localhost:8080

# Realm name
keycloak.realm=friendly-housing

# OAuth2 Resource Server configuration
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8080/realms/friendly-housing
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://localhost:8080/realms/friendly-housing/protocol/openid-connect/certs

# ========================================================================
# REMOVE THESE OLD JWT CONFIGURATIONS
# ========================================================================
# ? NO LONGER NEEDED - Keycloak handles token validation now!
# spring.app.jwtSecret=mySecretKey123912738aopsgjnspkmndfsopkvajoirjg94gf2opfng2moknm
# spring.app.jwtExpirationMs=3000000

# ========================================================================
# SERVICE URLS (for Feign Clients)
# ========================================================================

app.services.user-service.url=http://localhost:8081
app.services.property-service.url=http://localhost:8082

# ========================================================================
# CLOUD CONFIGURATION (Disable for standalone mode)
# ========================================================================

# Disable Spring Cloud compatibility check
spring.cloud.compatibility-verifier.enabled=false

# Disable discovery and cloud features
eureka.client.enabled=false
spring.cloud.discovery.enabled=false
spring.cloud.config.enabled=false
spring.cloud.service-registry.auto-registration.enabled=false
spring.cloud.features.enabled=false

# ========================================================================
# ACTUATOR CONFIGURATION
# ========================================================================

#management.endpoints.web.exposure.include=health,info
# Actuator
management.endpoints.web.exposure.include=health,circuitbreakers,metrics

management.endpoint.health.show-details=always
management.endpoints.enabled-by-default=true

# ========================================================================
# LOGGING CONFIGURATION
# ========================================================================

logging.level.root=INFO
logging.level.com.example.appointmentservice=DEBUG
logging.level.org.springframework.data.mongodb.core.MongoTemplate=DEBUG
logging.level.org.springframework.data.mongodb=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# ========================================================================
# FEIGN CLIENT CONFIGURATION
# ========================================================================

# Enable Feign logging
logging.level.com.example.appointmentservice.business.client=DEBUG

# Feign client configuration
feign.client.config.default.connectTimeout=5000
feign.client.config.default.readTimeout=10000
feign.client.config.default.loggerLevel=BASIC


# RabbitMQ connection settings
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# Optional: Configure listener concurrency and prefetch
spring.rabbitmq.listener.simple.concurrency=3
spring.rabbitmq.listener.simple.max-concurrency=10
spring.rabbitmq.listener.simple.prefetch=1



# Circuit Breaker (same pattern as Booking Service)
resilience4j.circuitbreaker.instances.userService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.userService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.userService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.userService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.userService.waitDurationInOpenState=10s

resilience4j.circuitbreaker.instances.propertyService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.propertyService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.propertyService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.propertyService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.propertyService.waitDurationInOpenState=10s

# Retry
resilience4j.retry.instances.userService.maxAttempts=3
resilience4j.retry.instances.userService.waitDuration=1s
resilience4j.retry.instances.propertyService.maxAttempts=3
resilience4j.retry.instances.propertyService.waitDuration=1s

